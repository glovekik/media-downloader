<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Downloader</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <h1>YouTube Downloader</h1>
    <h5>Paste Your Link in the Below Field</h5>
    
    <!-- Input and Button -->
    <div>
      <input id="linkInput" type="text" placeholder="Enter Your Link" />
    </div>
    <div>
      <button id="downloadBtn">Download Now!!!</button>
    </div>

    <!-- Loading Indicator (Initially Hidden) -->
    <div id="loading" style="display: none;">Loading...</div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
          const inputField = document.querySelector('#linkInput');
          const downloadButton = document.querySelector('#downloadBtn');
          const loadingIndicator = document.querySelector('#loading');
          
          downloadButton.addEventListener("click", function () {
              const link = inputField.value.trim();
              
              // Simple Validation for YouTube Link (Extended to include youtu.be)
              const youtubeLinkPattern = /^(https:\/\/(www\.)?youtube\.com\/.+|https:\/\/youtu\.be\/.+)$/;
              if (link === "") {
                  alert("Please enter a link!");
                  return;
              }
              if (!youtubeLinkPattern.test(link)) {
                  alert("Please enter a valid YouTube link!");
                  return;
              }

              // Show loading indicator and disable the input
              loadingIndicator.style.display = "block";
              inputField.disabled = true;
              downloadButton.disabled = true;

              fetch("https://media-downloader-backend-nine.vercel.app/download", {
                  method: "POST",
                  headers: {
                      "Content-Type": "application/json"
                  },
                  body: JSON.stringify({ link: link })
              })
              .then(response => {
                  if (!response.ok) {
                      return Promise.reject('Failed to fetch the audio!');
                  }
                  return response.json();
              })
              .then(data => {
                  // Hide loading indicator and enable input/button
                  loadingIndicator.style.display = "none";
                  inputField.disabled = false;
                  downloadButton.disabled = false;

                  if (data.message) {
                      alert(data.message);  // Display success message
                      inputField.value = ""; // Clear input field after success
                  } else if (data.error) {
                      alert(data.error);    // Display error message
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  alert('An error occurred. Please try again.');  // Handle error
                  
                  // Hide loading indicator and enable input/button
                  loadingIndicator.style.display = "none";
                  inputField.disabled = false;
                  downloadButton.disabled = false;
              });
          });
      });
    </script>
  </body>
</html>
