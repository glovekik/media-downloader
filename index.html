<script>
  document.addEventListener("DOMContentLoaded", function () {
    const inputField = document.querySelector("#linkInput");
    const downloadButton = document.querySelector("#downloadBtn");
    const loadingIndicator = document.querySelector("#loading");
    const errorMessage = document.querySelector("#error-message");

    downloadButton.addEventListener("click", function () {
      const link = inputField.value.trim();

      // Simple Validation for YouTube Link
      const youtubeLinkPattern = /^(https:\/\/(www\.)?youtube\.com\/.+|https:\/\/youtu\.be\/.+)$/;
      if (link === "") {
        alert("Please enter a link!");
        return;
      }
      if (!youtubeLinkPattern.test(link)) {
        alert("Please enter a valid YouTube link!");
        return;
      }

      // Show loading indicator and disable the input
      loadingIndicator.style.display = "block";
      inputField.disabled = true;
      downloadButton.disabled = true;
      errorMessage.style.display = "none"; // Hide error message

      fetch("https://media-downloader-backend-production.up.railway.app/download", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ link: link }),
      })
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
          loadingIndicator.style.display = "none";
          inputField.disabled = false;
          downloadButton.disabled = false;

          if (data.downloadUrl) {
            // Redirect to the download URL
            window.location.href = data.downloadUrl;
          } else if (data.error) {
            alert(data.error); // Display error message
          } else {
            alert("Unexpected response from server.");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
          alert("An error occurred. Please try again.");
          
          // Reset UI on error
          loadingIndicator.style.display = "none";
          inputField.disabled = false;
          downloadButton.disabled = false;
          errorMessage.textContent = "An error occurred while processing your request.";
          errorMessage.style.display = "block";
        });
    });
  });
</script>
